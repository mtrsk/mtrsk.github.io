<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
  How to use private NeoVim plugins on NixOS

    </title>
    <meta property="og:url" content="https://mtrsk.github.io/blog/2023/how-to-use-private-neovim-plugins-on-nixos/">
  <meta property="og:site_name" content="Benevides&#39; Blog">
  <meta property="og:title" content="How to use private NeoVim plugins on NixOS">
  <meta property="og:description" content="Over time my config changed a lot since the early days, as of now I’m using a combination of Flakes and home-manager to manage my workstations. I try not to overthink too much when it comes to Nix, my current Neovim setup is pretty simple, lua-based, yet, fully nixified.
dotfiles ├── (...) ├── nvim │ ├── files.lua │ ├── line.lua │ ├── lsp.lua │ ├── settings.lua │ ├── tabs.lua │ └── treesitter.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2023-09-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-09-17T00:00:00+00:00">
<link rel="stylesheet" href="/css/main.min.b0ac2a435097757bc0f52ca79b98b87531ff99fa1b4c88d169395513962577d9.css" />
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  </head>
  <body><nav>
  <img
    src="/img/logo.png"
    alt="put your logo here"
    width="128"
    height="128"
  />
  <div>
    <h1>Benevides&#39; Blog</h1><p>&#34;Writing is nothing more than a guided dream.&#34;</p>
  </div>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/blog">Blog</a></li>
    <li><a href="/notes">Notes</a></li>
    <li><a href="/blogroll">BlogRoll</a></li>
  </ul>
</nav>
<main>
  <h2>How to use private NeoVim plugins on NixOS
    <small>
      <time>September 17, 2023</time>
    by Marcos Benevides


    </small>
  </h2><p>Over time my config changed a lot since the early days, as of now I&rsquo;m using a
combination of <a href="https://nixos.wiki/wiki/Flakes">Flakes</a> and <a href="https://github.com/nix-community/home-manager">home-manager</a> to manage my workstations. I try not to overthink
too much when it comes to Nix, my current Neovim setup is pretty simple, lua-based, yet,
fully nixified.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">  dotfiles
</span></span><span class="line"><span class="cl">  ├── <span class="o">(</span>...<span class="o">)</span>
</span></span><span class="line"><span class="cl">  ├── nvim
</span></span><span class="line"><span class="cl">  │   ├── files.lua
</span></span><span class="line"><span class="cl">  │   ├── line.lua
</span></span><span class="line"><span class="cl">  │   ├── lsp.lua
</span></span><span class="line"><span class="cl">  │   ├── settings.lua
</span></span><span class="line"><span class="cl">  │   ├── tabs.lua
</span></span><span class="line"><span class="cl">  │   └── treesitter.lua
</span></span><span class="line"><span class="cl">  ├── <span class="o">(</span>...<span class="o">)</span>
</span></span><span class="line"><span class="cl">  └── zsh
</span></span><span class="line"><span class="cl">  └── zshrc
</span></span></code></pre></div><p>I do it by having a simple directory where all my Neovim derivations stand.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">  home
</span></span><span class="line"><span class="cl">  ├── <span class="o">(</span>...<span class="o">)</span>
</span></span><span class="line"><span class="cl">  ├── development
</span></span><span class="line"><span class="cl">  │   ├── cloud.nix
</span></span><span class="line"><span class="cl">  │   ├── default.nix
</span></span><span class="line"><span class="cl">  │   ├── git.nix
</span></span><span class="line"><span class="cl">  │   ├── iac.nix
</span></span><span class="line"><span class="cl">  │   ├── kubernetes.nix
</span></span><span class="line"><span class="cl">  │   └── programming.nix
</span></span><span class="line"><span class="cl">  ├── editors.nix
</span></span><span class="line"><span class="cl">  ├── <span class="o">(</span>...<span class="o">)</span>
</span></span><span class="line"><span class="cl">  ├── neovim
</span></span><span class="line"><span class="cl">  │   ├── default.nix
</span></span><span class="line"><span class="cl">  │   ├── packages.nix
</span></span><span class="line"><span class="cl">  │   └── private.nix
</span></span><span class="line"><span class="cl">  ├── <span class="o">(</span>...<span class="o">)</span>
</span></span><span class="line"><span class="cl">  └── zshell.nix
</span></span></code></pre></div><p>here&rsquo;s an example of what a <code>private.nix</code> file would look like, this is useful
when you want to use some package that&rsquo;s not available yet into <a href="https://github.com/NixOS/nixpkgs">nixpkgs</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl">  <span class="p">{</span> <span class="n">pkgs</span><span class="o">,</span> <span class="n">config</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">let</span>
</span></span><span class="line"><span class="cl">    <span class="n">plugin</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">vimUtils</span><span class="o">.</span><span class="n">buildVimPlugin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">in</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">vim-taskjuggler</span> <span class="o">=</span> <span class="n">plugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;vim-taskjuggler&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">src</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">fetchFromGitHub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">owner</span> <span class="o">=</span> <span class="s2">&#34;kalafut&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">repo</span> <span class="o">=</span> <span class="s2">&#34;vim-taskjuggler&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">rev</span> <span class="o">=</span> <span class="s2">&#34;e94c9a0b06022d11a34310ad5f82c1c2bcd86fb7&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">sha256</span> <span class="o">=</span> <span class="s2">&#34;0f8smjl6wi52p8n1hhl5zhk8i3lpsfndxxdammyybw2vz17s0j8q&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>then you can just import it from other files:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl">  <span class="p">{</span> <span class="n">pkgs</span><span class="o">,</span> <span class="n">config</span><span class="o">,</span> <span class="n">lib</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">let</span>
</span></span><span class="line"><span class="cl">    <span class="n">plugins</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">vimPlugins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">private</span> <span class="o">=</span> <span class="kn">import</span> <span class="sr">./private.nix</span> <span class="p">{</span> <span class="k">inherit</span> <span class="n">pkgs</span> <span class="n">config</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="k">in</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">base</span> <span class="o">=</span> <span class="k">with</span> <span class="n">plugins</span><span class="p">;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="n">nvim-surround</span>
</span></span><span class="line"><span class="cl">      <span class="n">vim-which-key</span>
</span></span><span class="line"><span class="cl">      <span class="n">vim-visual-multi</span>
</span></span><span class="line"><span class="cl">      <span class="n">hologram-nvim</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">eyecandy</span> <span class="o">=</span> <span class="k">with</span> <span class="n">plugins</span> <span class="o">//</span> <span class="n">private</span><span class="p">;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="n">kanagawa-nvim</span>
</span></span><span class="line"><span class="cl">      <span class="n">nvim-colorizer-lua</span>
</span></span><span class="line"><span class="cl">      <span class="n">nvim-cursorline</span>
</span></span><span class="line"><span class="cl">      <span class="n">nvim-web-devicons</span>
</span></span><span class="line"><span class="cl">      <span class="n">tokyonight-nvim</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">ui</span> <span class="o">=</span> <span class="k">with</span> <span class="n">plugins</span><span class="p">;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># File Tree</span>
</span></span><span class="line"><span class="cl">      <span class="n">nvim-tree-lua</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Find/Filter</span>
</span></span><span class="line"><span class="cl">      <span class="n">plenary-nvim</span>
</span></span><span class="line"><span class="cl">      <span class="n">telescope-nvim</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Status Line</span>
</span></span><span class="line"><span class="cl">      <span class="n">lualine-nvim</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Tabs</span>
</span></span><span class="line"><span class="cl">      <span class="n">barbar-nvim</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">lsp</span> <span class="o">=</span> <span class="k">with</span> <span class="n">plugins</span> <span class="o">//</span> <span class="n">private</span><span class="p">;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="n">nvim-cmp</span>
</span></span><span class="line"><span class="cl">      <span class="n">nvim-lspconfig</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="n">nvim-treesitter</span><span class="o">.</span><span class="n">withPlugins</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">bash</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">dockerfile</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">gitignore</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">lua</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">markdown</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">nix</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">proto</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">scheme</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">sql</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">terraform</span>
</span></span><span class="line"><span class="cl">          <span class="n">p</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Snippets</span>
</span></span><span class="line"><span class="cl">      <span class="n">luasnip</span>
</span></span><span class="line"><span class="cl">      <span class="n">cmp-git</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># CMP Plugins</span>
</span></span><span class="line"><span class="cl">      <span class="n">cmp-cmdline</span>
</span></span><span class="line"><span class="cl">      <span class="n">cmp_luasnip</span>
</span></span><span class="line"><span class="cl">      <span class="n">cmp-nvim-lsp</span>
</span></span><span class="line"><span class="cl">      <span class="n">cmp-path</span>
</span></span><span class="line"><span class="cl">      <span class="n">cmp-treesitter</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">tooling</span> <span class="o">=</span> <span class="k">with</span> <span class="n">plugins</span><span class="p">;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="n">direnv-vim</span>
</span></span><span class="line"><span class="cl">      <span class="n">Ionide-vim</span>
</span></span><span class="line"><span class="cl">      <span class="n">vim-nix</span>
</span></span><span class="line"><span class="cl">      <span class="n">vim-terraform</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>and <a href="https://nix-community.github.io/home-manager/options.html#opt-programs.neovim.enable">since Neovim has an awesome module in home-manager</a>, make sure to use it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl">  <span class="n">programs</span><span class="o">.</span><span class="n">neovim</span> <span class="err">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># (...)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plugins</span> <span class="o">=</span> <span class="n">vimPlugins</span><span class="o">.</span><span class="n">base</span> <span class="o">++</span> <span class="n">vimPlugins</span><span class="o">.</span><span class="n">eyecandy</span> <span class="o">++</span> <span class="n">vimPlugins</span><span class="o">.</span><span class="n">ui</span> <span class="o">++</span> <span class="n">vimPlugins</span><span class="o">.</span><span class="n">lsp</span> <span class="o">++</span> <span class="n">vimPlugins</span><span class="o">.</span><span class="n">tooling</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span></code></pre></div><p>If you want to see an up-to-date version of these dotfiles, feel free to <del>steal</del>
take a look <a href="https://github.com/mtrsk/nixos-config/tree/master/home/neovim">here</a>.</p>



   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   





<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/mtrsk/mtrsk.github.io">here</a>.
  </p>
</footer>

      </main>
    </main>
  </body>
</html>
