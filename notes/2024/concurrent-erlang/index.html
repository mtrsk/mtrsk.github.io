<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
  Concurrent Erlang

    </title>
    <meta property="og:url" content="https://schonfinkel.github.io/notes/2024/concurrent-erlang/">
  <meta property="og:site_name" content="Benevides&#39; Blog">
  <meta property="og:title" content="Concurrent Erlang">
  <meta property="og:description" content=":ID: 63607e63-4428-4578-bf2a-12a49649b49c
I’m sure you’ve met processes before, but only in the context of operating systems. In Erlang, processes belong to the programming language and not the operating system. This means that Erlang processes will have the same logical behavior on any operating system, so we can write portable concurrent code that can run on any operating system that supports Erlang.
In Erlang:
Creating and destroying processes is very fast. Sending messages between processes is very fast.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="notes">
    <meta property="article:published_time" content="2024-09-30T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-30T00:00:00+00:00">
    <meta property="article:tag" content="Erlang">
<link rel="stylesheet" href="/css/main.min.1135c79bd24c232c465ba2c4e5a9644086ce3f8358dbd0e0d76c5e86d24f1fad.css" />
    
        <script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>

    
  </head>
  <body><nav>
  <img
    src="/img/logo.png"
    alt="put your logo here"
    width="128"
    height="128"
  />
  <div>
    <h1>Benevides&#39; Blog</h1><p>&#34;Writing is nothing more than a guided dream.&#34;</p>
  </div>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/blog">Blog</a></li>
    <li><a href="/notes">Notes</a></li>
    <li><a href="/blogroll">BlogRoll</a></li>
  </ul>
</nav>
<main>
  <h2>Concurrent Erlang
    <small>
      <time>September 30, 2024</time>
    by Marcos Benevides


    </small>
  </h2><p>:ID:       63607e63-4428-4578-bf2a-12a49649b49c</p>
<blockquote>
<p>I’m sure you’ve met processes before, but only in the context of operating
systems. In Erlang, processes belong to the programming language and not the
operating system. This means that Erlang processes will have the same logical
behavior on any operating system, so we can write portable concurrent code that
can run on any operating system that supports Erlang.</p>
<p>In Erlang:</p>
<ul>
<li>Creating and destroying processes is very fast.</li>
<li>Sending messages between processes is very fast.</li>
<li>Processes behave the same way on all operating systems.</li>
<li>We can have very large numbers of processes.</li>
<li>Processes share no memory and are completely independent.</li>
<li>The only way for processes to interact is through message passing.</li>
</ul>
<p>(<a href="#citeproc_bib_item_1">Armstrong 2013, 181</a>)</p>
</blockquote>
<h2 id="processes">Processes</h2>
<p>In <a href="/notes/2024/erlang/">Erlang</a>, creation of a parallel process is achieved by evaluating the <code>spawn</code>
primitive. This primitive creates a concurrent process and returns a process
identifier (PID) that can used to interact with the newly created process:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-erlang" data-lang="erlang"><span class="line"><span class="cl"><span class="nv">Pid</span> <span class="o">=</span> <span class="nb">spawn</span><span class="p">(</span><span class="nv">ModName</span><span class="p">,</span> <span class="nv">FuncName</span><span class="p">,</span> <span class="p">[</span><span class="nv">Arg1</span><span class="p">,</span> <span class="nv">Arg2</span><span class="p">,</span> <span class="p">...,</span> <span class="nv">ArgN</span><span class="p">]).</span>
</span></span></code></pre></div><figure><img src="/img/notes/erlang_spawn.png">
</figure>

<ul>
<li>This BIF never fails</li>
<li>A process can either terminate:
<ul>
<li>Abormally when run-time errors occur</li>
<li>Normally when there is no more code to execute</li>
</ul>
</li>
</ul>
<h3 id="modeling-concurrency">Modeling Concurrency</h3>
<figure><img src="/img/notes/erlang_send.png">
</figure>

<p>The syntax <code>Pid ! Msg</code> means &ldquo;send the message <code>Msg</code> to the process <code>Pid</code>&rdquo;, where <code>Msg</code>
is from any valid <a href="/notes/2024/erlang/">Erlang</a> data type. Also, <code>Pid1 ! Pid2 ! ... ! Msg</code> means send the
message Msg to all the processes <code>Pid1</code>, <code>Pid2</code>, and so on. The <code>receive ... end</code>
construct is used for a process to read a message that has been sent:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-erlang" data-lang="erlang"><span class="line"><span class="cl"><span class="k">receive</span>
</span></span><span class="line"><span class="cl">   <span class="nv">Pattern1</span> <span class="p">[</span><span class="k">when</span> <span class="nv">Guard1</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="nv">Expression1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="nv">Pattern2</span> <span class="p">[</span><span class="k">when</span> <span class="nv">Guard2</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="nv">Expression2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><ul>
<li>
<p>Sending a message will never fail.</p>
</li>
<li>
<p>A message sent to non-existing processes are throw away.</p>
</li>
<li>
<p>Received messages are store in a process&rsquo; mailbox.</p>
</li>
<li>
<p>Mailboxes are scanned sequentially.</p>
</li>
<li>
<p>If a message fails to be pattern matched, it&rsquo;s saved in a queue for later
processing and the process waits for the next message. It is possible to
update a process with a new version of the code that retrieves those messages.</p>
<p>The erlang shell (<code>erl</code>) is itself a process, you can test its message-passing
functionalities by using the <code>self</code> keyword:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">    1&gt; self<span class="o">()</span> ! hello.
</span></span><span class="line"><span class="cl">    hello
</span></span><span class="line"><span class="cl">    2&gt; receive X -&gt; X end.
</span></span><span class="line"><span class="cl">    hello
</span></span></code></pre></div><ul>
<li>
<p>Messages can be matched and selectivelly retrieved.</p>
</li>
<li>
<p>We can force an order (emulating a priority queue) by using multiple receives:</p>
<figure><img src="/img/notes/erlang_selective.png">
        </figure>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-erlang" data-lang="erlang"><span class="line"><span class="cl">      <span class="k">receive</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="n">foo</span><span class="p">,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">(...)</span>
</span></span><span class="line"><span class="cl">      <span class="k">end</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">(...)</span>
</span></span><span class="line"><span class="cl">      <span class="k">receive</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="n">bar</span><span class="p">,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">(...)</span>
</span></span><span class="line"><span class="cl">      <span class="k">end</span><span class="p">,</span>
</span></span></code></pre></div><p>this way the message <code>{foo, ...}</code> is received before the message <code>{bar, ...}</code>.</p>
</li>
</ul>
</li>
</ul>
<h3 id="registered-processes">Registered Processes</h3>
<table>
<thead>
<tr>
<th>BIF</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>register(Name, Pid)</code></td>
<td>Associates the name <code>Name</code>, an atom, with the process <code>Pid</code>.</td>
</tr>
<tr>
<td><code>registered/0</code></td>
<td>Returns a list of names that have been registered using <code>register/2</code>.</td>
</tr>
<tr>
<td><code>whereis(Name)</code></td>
<td>Returns the pid registered under <code>Name</code>, or <code>undefined</code> if the name is not registered.</td>
</tr>
<tr>
<td><code>registered()</code></td>
<td>Return a list of all registered processes in the system.</td>
</tr>
</tbody>
</table>
<ul>
<li>Sending messages to a non-existing registered process causes the calling
process to terminate with a <code>badarg</code> error.</li>
</ul>
<h3 id="timeouts">Timeouts</h3>
<ul>
<li>If the message <code>Msg</code> is received within the <code>TimeOut</code>, <code>expr01</code> will be
executed. Otherwise, <code>expr02</code> will be executed.</li>
<li><code>TimeOut</code> is an integer denoting the time in miliseconds or the Atom <code>infinity</code>.</li>
</ul>
<figure><img src="/img/notes/erlang_timeout.png">
</figure>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-erlang" data-lang="erlang"><span class="line"><span class="cl">  <span class="k">receive</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Msg</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="n">expr01</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">after</span> <span class="nv">TimeOut</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="n">expr02</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span>
</span></span></code></pre></div><h3 id="skeleton-of-an-erlang-process">Skeleton of an Erlang Process</h3>
<figure><img src="/img/notes/erlang_process_skeleton.png">
</figure>

<h2 id="references">References</h2>
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Armstrong, Joe. 2013. “Programming Erlang: Software for a Concurrent World.”</div>
</div>



   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   




  <hr>
  <div class="bl-section">
    <h4>Links to this note</h4>
    <div class="backlinks">
      <ul>
       
          <li><a href="/notes/2024/error-handling-in-erlang/">Error Handling In Erlang</a></li>
       
     </ul>
    </div>
  </div>


<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/mtrsk/mtrsk.github.io">here</a>.
  </p>
</footer>

      </main>
    </main>
  </body>
</html>
