<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
  Error Handling In Erlang

    </title>
    <meta property="og:url" content="https://mtrsk.github.io/notes/2024/error-handling-in-erlang/">
  <meta property="og:site_name" content="Benevides&#39; Blog">
  <meta property="og:title" content="Error Handling In Erlang">
  <meta property="og:description" content=":ID: 22ae9c25-3123-4ed8-b765-369ac89d2942
In Erlang we do exactly the opposite. We build our applications in two parts: a part that solves the problem and a part that corrects errors if they have occurred.
The part that solves the problem is written with as little defensive code as possible; we assume that all arguments to functions are correct and the programs will execute without errors.
The part that corrects errors is often generic, so the same error-correcting code can be used for many different applications.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="notes">
    <meta property="article:published_time" content="2024-10-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-10-01T00:00:00+00:00">
    <meta property="article:tag" content="Erlang">
<link rel="stylesheet" href="/css/main.min.1135c79bd24c232c465ba2c4e5a9644086ce3f8358dbd0e0d76c5e86d24f1fad.css" />
    
        <script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>

    
  </head>
  <body><nav>
  <img
    src="/img/logo.png"
    alt="put your logo here"
    width="128"
    height="128"
  />
  <div>
    <h1>Benevides&#39; Blog</h1><p>&#34;Writing is nothing more than a guided dream.&#34;</p>
  </div>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/blog">Blog</a></li>
    <li><a href="/notes">Notes</a></li>
    <li><a href="/blogroll">BlogRoll</a></li>
  </ul>
</nav>
<main>
  <h2>Error Handling In Erlang
    <small>
      <time>October 1, 2024</time>
    by Marcos Benevides


    </small>
  </h2><p>:ID:       22ae9c25-3123-4ed8-b765-369ac89d2942</p>
<blockquote>
<p>In <a href="/notes/2024/erlang/">Erlang</a> we do exactly the opposite. We build our applications in two parts: a
part that solves the problem and a part that corrects errors if they have
occurred.</p>
<p>The part that solves the problem is written with as little defensive code as
possible; we assume that all arguments to functions are correct and the programs
will execute without errors.</p>
<p>The part that corrects errors is often generic, so the same error-correcting
code can be used for many different applications. (<a href="#citeproc_bib_item_1">Armstrong 2013, 201</a>)</p>
</blockquote>
<h2 id="error-handling-semantics">Error Handling Semantics</h2>
<h3 id="processes">Processes</h3>
<p>There are two types of processes: <strong>normal processes</strong> and <strong>system processes</strong>. <code>spawn</code>
(see <a href="/notes/2024/concurrent-erlang/">Concurrent Erlang</a>) creates a normal process. A normal process can become a
system process by evaluating the BIF <code>process_flag(trap_exit, true)</code>.</p>
<h3 id="link">Link</h3>
<p>Linking processes can be thought as an extension of the error handling presented
when dealing with <a href="/notes/2024/sequential-erlang/">Sequential Erlang</a>. We can, if necessary, catch exceptions
early in the sequential code, that still won&rsquo;t make our application fault
tolerant.</p>
<blockquote>
<p>For one process to observe another, we must create a <code>link</code> or <code>monitor</code> between the
processes. If the linked or monitored processes dies, the observing process is
informed.</p>
<p>Observing processes work transparently across machine boundaries, so a
process running on one machine can monitor the behavior of a process run-
ning on a different machine. This is the basis for programming fault-tolerant
systems. (<a href="#citeproc_bib_item_1">Armstrong 2013, 200</a>)</p>
</blockquote>
<p>To create links, we call the primitive <code>link(Pid)</code>, which creates a link between the
calling process and <code>Pid</code>. So, if <code>Pid1</code> calls <code>link(Pid2)</code>, a link is created between <code>Pid1</code> and
<code>Pid2</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-erlang" data-lang="erlang"><span class="line"><span class="cl">  <span class="nv">Pid1</span> <span class="o">=</span> <span class="nb">link</span><span class="p">(</span><span class="nv">Pid2</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li><code>link/1</code> creates a bi-directional link between the process calling the BIF (<code>Pid1</code>) and
the process linked (<code>Pid2</code>).</li>
<li><code>spawn_link/3</code> will yield the same result as <code>spawn/3</code> followed by <code>link/1</code>, only that
will do so atomically.</li>
<li><code>unlink/1</code> removes the link to <code>Pid</code>.</li>
</ul>
<figure><img src="/img/notes/erlang_process_link.png">
</figure>

<h4 id="link-set">Link Set</h4>
<p>The link set of a process <code>P</code> is the set of processes that are linked to <code>P</code>.</p>
<figure><img src="/img/notes/erlang_link_set.png">
</figure>

<h4 id="groups-of-processes-that-all-die-together">Groups of Processes That All Die Together</h4>
<p>In the previous example, if a single process from the Link Set fails, all the
processes from the Set also fail in cascate. Ultimately, the error signals
propagate to all the linked processes, and the entire group of linked processes
dies.</p>
<figure><img src="/img/notes/erlang_link_set_cascade.png">
</figure>

<blockquote>
<p>When an Erlang process fails, it sends an explanation to other processes that
are linked to it in the form of a tuple. The tuple contains the atom <code>EXIT</code>, the
<code>Pid</code> of the failed process, and the error as a complex tuple. (<a href="#citeproc_bib_item_2">Laurent 2017, 100</a>)</p>
</blockquote>
<h3 id="exit-signals">Exit Signals</h3>
<ul>
<li>A process can termination can be <strong>normal</strong> or <strong>abnormal</strong>.
<ul>
<li><strong>Normal</strong>: When there is no more code to execute.</li>
<li><strong>Abnormal</strong>: When runtime errors occur.</li>
</ul>
</li>
<li>When a process terminates, it sends a signal to all process its linked to. The
exit signal will contain the following information:
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sender Identifier</strong></td>
<td>The process or port identifier of the process or port that terminated.</td>
</tr>
<tr>
<td><strong>Receiver Identifier</strong></td>
<td>The process or port identifier of the process or port which the exit signal is sent to.</td>
</tr>
<tr>
<td>The <code>link</code> flag</td>
<td>This flag will be set indicating that the exit signal was sent due to a link.</td>
</tr>
<tr>
<td><code>exit</code> reason</td>
<td></td>
</tr>
</tbody>
</table>
</li>
</ul>
<figure><img src="/img/notes/erlang_error_exit_signals.png">
</figure>

<h3 id="error-trapping">Error Trapping</h3>
<blockquote>
<p>If your process is set to trap exits, through a call to <code>process_flag(trap_exit, true)</code>, these error reports arrive as messages, rather than just killing your
process. (<a href="#citeproc_bib_item_2">Laurent 2017, 100</a>)</p>
</blockquote>
<h4 id="propagation-semantics">Propagation Semantics</h4>
<ul>
<li>Processes can trap <code>exit</code> signals by calling the BIF <code>process_flag(trap_exit, true)</code>.</li>
<li>Once trapped, the errors are saved in the mailbox.</li>
</ul>
<figure><img src="/img/notes/erlang_error_trapping.png">
</figure>

<p><code>Pid2</code> functions as a firewall, stopping errors from propagating to other processes in the system.</p>
<h3 id="monitors">Monitors</h3>
<p>Monitors are similar to links but with several significant differences.</p>
<ul>
<li>Monitors are unidirectional.</li>
</ul>
<p>A process <code>Pid1</code> can create a monitor for <code>Pid2</code> by calling the BIF
<code>erlang:monitor(process, Pid2)</code>. The function returns a reference <code>Ref</code>.</p>
<figure><img src="/img/notes/erlang_monitor.png">
</figure>

<ul>
<li>When a monitored process dies, a &ldquo;down&rdquo; message (not an <code>exit</code> signal) is sent
to the monitoring process.</li>
</ul>
<figure><img src="/img/notes/erlang_monitor_error.png">
</figure>

<h2 id="references">References</h2>
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Armstrong, Joe. 2013. “Programming Erlang: Software for a Concurrent World.”</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Laurent, Simon St. 2017. <i>Introducing Erlang: Getting Started in Functional Programming</i>. O’Reilly Media, Inc.</div>
</div>



   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   





<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/mtrsk/mtrsk.github.io">here</a>.
  </p>
</footer>

      </main>
    </main>
  </body>
</html>
